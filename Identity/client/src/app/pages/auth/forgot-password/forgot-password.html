<div class="forgot-password-container">
  <div class="forgot-password-header">
    <button type="button" class="back-btn" (click)="goBack()">
      <i class="pi pi-arrow-left"></i>
      {{ currentStep() === 'reset' ? 'Back to Email' : 'Back to Login' }}
    </button>

    <h1>{{ currentStepConfig.title }}</h1>
    <p>{{ currentStepConfig.description }}</p>
  </div>

  <div class="forgot-password-card">
    <!-- Success Message -->
    @if (successMessage()) {
      <div class="message success-message">
        <i class="pi pi-check-circle"></i>
        <span>{{ successMessage() }}</span>
      </div>
    }

    <!-- Error Message -->
    @if (errorMessage()) {
      <div class="message error-message">
        <i class="pi pi-exclamation-triangle"></i>
        <span>{{ errorMessage() }}</span>
      </div>
    }

    <!-- Step 1: Email Input -->
    @if (currentStep() === 'email') {
      <form [formGroup]="emailForm" (ngSubmit)="requestPasswordReset()" class="forgot-password-form">
        <div class="form-group">
          <label for="email">Email Address</label>
          <input
            id="email"
            type="email"
            formControlName="email"
            class="form-input"
            [class.error]="getFieldError(emailForm, 'email')"
            placeholder="Enter your email address"
            autocomplete="email"
          />
          @if (getFieldError(emailForm, 'email')) {
            <div class="error-text">{{ getFieldError(emailForm, 'email') }}</div>
          }
        </div>

        <button
          type="submit"
          class="primary-btn"
          [disabled]="isLoading()"
          [class.loading]="isLoading()"
        >
          @if (isLoading()) {
            <i class="pi pi-spinner pi-spin"></i>
            Sending...
          } @else {
            Send Verification Code
          }
        </button>
      </form>
    }

    <!-- Step 2: Reset Password -->
    @if (currentStep() === 'reset') {
      <div class="reset-info">
        <p>We've sent a verification code to <strong>{{ userEmail() }}</strong></p>
        <p>Please check your email and enter the code below to reset your password.</p>
      </div>

      <form [formGroup]="resetForm" (ngSubmit)="resetPassword()" class="forgot-password-form">
        <div class="form-group">
          <label for="resetCode">Verification Code</label>
          <input
            id="resetCode"
            type="text"
            formControlName="resetCode"
            class="form-input"
            [class.error]="getFieldError(resetForm, 'resetCode')"
            placeholder="Enter 6-digit verification code"
            maxlength="6"
            autocomplete="off"
          />
          @if (getFieldError(resetForm, 'resetCode')) {
            <div class="error-text">{{ getFieldError(resetForm, 'resetCode') }}</div>
          }
        </div>

        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input
            id="newPassword"
            type="password"
            formControlName="newPassword"
            class="form-input"
            [class.error]="getFieldError(resetForm, 'newPassword')"
            placeholder="Enter new password (min 8 characters)"
            autocomplete="new-password"
          />
          @if (getFieldError(resetForm, 'newPassword')) {
            <div class="error-text">{{ getFieldError(resetForm, 'newPassword') }}</div>
          }
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm New Password</label>
          <input
            id="confirmPassword"
            type="password"
            formControlName="confirmPassword"
            class="form-input"
            [class.error]="getFieldError(resetForm, 'confirmPassword')"
            placeholder="Confirm your new password"
            autocomplete="new-password"
          />
          @if (getFieldError(resetForm, 'confirmPassword')) {
            <div class="error-text">{{ getFieldError(resetForm, 'confirmPassword') }}</div>
          }
        </div>

        <button
          type="submit"
          class="primary-btn"
          [disabled]="isLoading()"
          [class.loading]="isLoading()"
        >
          @if (isLoading()) {
            <i class="pi pi-spinner pi-spin"></i>
            Resetting...
          } @else {
            Reset Password
          }
        </button>

        <div class="resend-section">
          <p>Didn't receive the code?</p>
          <button type="button" class="link-btn" (click)="resendCode()">
            Resend verification code
          </button>
        </div>
      </form>
    }

    <!-- Alternative Actions -->
    <div class="alternative-actions">
      <a routerLink="/auth/choice" class="link-btn">
        Create New Account
      </a>
      <span class="separator">|</span>
      <a routerLink="/auth/login" class="link-btn">
        Back to Sign In
      </a>
    </div>
  </div>
</div>
