<div class="adoption-application-container p-4">
  <div class="max-w-4xl mx-auto">
    @if (pet()) {
    <!-- Header -->
    <div class="text-center mb-6">
      <h1 class="text-4xl font-bold text-900 mb-2">Adoption Application</h1>
      <p class="text-xl text-600">Apply to adopt {{ pet()!.name }}</p>
    </div>

    <!-- Pet Summary -->
    <p-card class="mb-6">
      <div class="flex align-items-center gap-4">
        <img
          [src]="pet()!.imageUrl"
          [alt]="pet()!.name"
          class="w-6rem h-6rem object-cover border-round"
        />
        <div>
          <h3 class="text-xl font-semibold text-900 mb-1">{{ pet()!.name }}</h3>
          <p class="text-600 mb-1">
            {{ pet()!.species }} • {{ pet()!.breed }} • {{ pet()!.age }} years
            old
          </p>
          <p class="text-600 text-sm mb-0">{{ pet()!.shelter }}</p>
        </div>
      </div>
    </p-card>

    <!-- Application Form -->
    <p-card>
      <form [formGroup]="applicationForm" (ngSubmit)="onSubmit()">
        <!-- Personal Information Section -->
        <div class="form-section mb-6">
          <h3 class="text-lg font-semibold text-900 mb-4">
            Personal Information
          </h3>
          <p class="text-sm text-600 mb-4">
            <i class="pi pi-info-circle mr-1"></i>
            This information is pre-filled from your account and cannot be
            changed here.
          </p>
          <div class="grid">
            <div class="col-12 md:col-6">
              <label for="firstName" class="block text-sm font-medium mb-2"
                >First Name *</label
              >
              <input
                pInputText
                id="firstName"
                formControlName="firstName"
                placeholder="Enter your first name"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('firstName')"
                readonly
              />
              @if (isFieldInvalid('firstName')) {
              <small class="p-error">{{ getFieldError('firstName') }}</small>
              }
            </div>
            <div class="col-12 md:col-6">
              <label for="lastName" class="block text-sm font-medium mb-2"
                >Last Name *</label
              >
              <input
                pInputText
                id="lastName"
                formControlName="lastName"
                placeholder="Enter your last name"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('lastName')"
                readonly
              />
              @if (isFieldInvalid('lastName')) {
              <small class="p-error">{{ getFieldError('lastName') }}</small>
              }
            </div>
            <div class="col-12 md:col-6">
              <label for="email" class="block text-sm font-medium mb-2"
                >Email *</label
              >
              <input
                pInputText
                id="email"
                type="email"
                formControlName="email"
                placeholder="Enter your email"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('email')"
                readonly
              />
              @if (isFieldInvalid('email')) {
              <small class="p-error">{{ getFieldError('email') }}</small>
              }
            </div>
            <div class="col-12 md:col-6">
              <label for="phone" class="block text-sm font-medium mb-2"
                >Phone Number *</label
              >
              <input
                pInputText
                id="phone"
                type="tel"
                formControlName="phone"
                placeholder="Enter your phone number"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('phone')"
              />
              @if (isFieldInvalid('phone')) {
              <small class="p-error">{{ getFieldError('phone') }}</small>
              }
            </div>
            <div class="col-12 md:col-6">
              <label for="dateOfBirth" class="block text-sm font-medium mb-2"
                >Date of Birth *</label
              >
              <input
                pInputText
                id="dateOfBirth"
                type="date"
                formControlName="dateOfBirth"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('dateOfBirth')"
              />
              @if (isFieldInvalid('dateOfBirth')) {
              <small class="p-error">{{ getFieldError('dateOfBirth') }}</small>
              }
            </div>
          </div>
        </div>

        <p-divider />

        <!-- Address Information Section -->
        <div class="form-section mb-6">
          <h3 class="text-lg font-semibold text-900 mb-4">
            Address Information
          </h3>
          <div class="grid">
            <div class="col-12">
              <label for="address" class="block text-sm font-medium mb-2"
                >Street Address *</label
              >
              <input
                pInputText
                id="address"
                formControlName="address"
                placeholder="Enter your street address"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('address')"
              />
              @if (isFieldInvalid('address')) {
              <small class="p-error">{{ getFieldError('address') }}</small>
              }
            </div>
            <div class="col-12 md:col-4">
              <label for="city" class="block text-sm font-medium mb-2"
                >City *</label
              >
              <input
                pInputText
                id="city"
                formControlName="city"
                placeholder="Enter your city"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('city')"
              />
              @if (isFieldInvalid('city')) {
              <small class="p-error">{{ getFieldError('city') }}</small>
              }
            </div>
            <div class="col-12 md:col-4">
              <label for="state" class="block text-sm font-medium mb-2"
                >State *</label
              >
              <input
                pInputText
                id="state"
                formControlName="state"
                placeholder="Enter your state"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('state')"
              />
              @if (isFieldInvalid('state')) {
              <small class="p-error">{{ getFieldError('state') }}</small>
              }
            </div>
            <div class="col-12 md:col-4">
              <label for="postcode" class="block text-sm font-medium mb-2"
                >Postcode *</label
              >
              <input
                pInputText
                id="postcode"
                formControlName="postcode"
                placeholder="Enter your postcode"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('postcode')"
              />
              @if (isFieldInvalid('postcode')) {
              <small class="p-error">{{ getFieldError('postcode') }}</small>
              }
            </div>
          </div>
        </div>

        <p-divider />

        <!-- Housing Information Section -->
        <div class="form-section mb-6">
          <h3 class="text-lg font-semibold text-900 mb-4">
            Housing Information
          </h3>
          <div class="grid">
            <div class="col-12 md:col-6">
              <label for="housingType" class="block text-sm font-medium mb-2"
                >Housing Type *</label
              >
              <p-select
                id="housingType"
                formControlName="housingType"
                [options]="housingOptions"
                placeholder="Select housing type"
                optionLabel="label"
                optionValue="value"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('housingType')"
              />
              @if (isFieldInvalid('housingType')) {
              <small class="p-error">{{ getFieldError('housingType') }}</small>
              }
            </div>
            <div class="col-12 md:col-6">
              <label for="yardType" class="block text-sm font-medium mb-2"
                >Yard Type</label
              >
              <p-select
                id="yardType"
                formControlName="yardType"
                [options]="yardOptions"
                placeholder="Select yard type"
                optionLabel="label"
                optionValue="value"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('yardType')"
              />
              @if (isFieldInvalid('yardType')) {
              <small class="p-error">{{ getFieldError('yardType') }}</small>
              }
            </div>
            <div class="col-12">
              <div class="flex gap-4">
                <div class="flex align-items-center">
                  <p-checkbox
                    formControlName="isOwner"
                    [binary]="true"
                    inputId="isOwner"
                    class="mr-2"
                  />
                  <label for="isOwner" class="text-sm">I own my home</label>
                </div>
                <div class="flex align-items-center">
                  <p-checkbox
                    formControlName="hasYard"
                    [binary]="true"
                    inputId="hasYard"
                    class="mr-2"
                  />
                  <label for="hasYard" class="text-sm">I have a yard</label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <p-divider />

        <!-- Pet Experience Section -->
        <div class="form-section mb-6">
          <h3 class="text-lg font-semibold text-900 mb-4">
            Pet Experience & Lifestyle
          </h3>
          <div class="grid">
            <div class="col-12 md:col-6">
              <label for="previousPets" class="block text-sm font-medium mb-2"
                >Previous Pet Experience</label
              >
              <textarea
                pInputText
                id="previousPets"
                formControlName="previousPets"
                rows="3"
                placeholder="Tell us about any previous pets you've owned"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('previousPets')"
              ></textarea>
              @if (isFieldInvalid('previousPets')) {
              <small class="p-error">{{ getFieldError('previousPets') }}</small>
              }
            </div>
            <div class="col-12 md:col-6">
              <label for="currentPets" class="block text-sm font-medium mb-2"
                >Current Pets</label
              >
              <textarea
                pInputText
                id="currentPets"
                formControlName="currentPets"
                rows="3"
                placeholder="Tell us about any current pets (breed, age, temperament)"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('currentPets')"
              ></textarea>
              @if (isFieldInvalid('currentPets')) {
              <small class="p-error">{{ getFieldError('currentPets') }}</small>
              }
            </div>
            <div class="col-12 md:col-6">
              <label for="hoursAlone" class="block text-sm font-medium mb-2"
                >Hours Pet Will Be Alone Daily *</label
              >
              <p-select
                id="hoursAlone"
                formControlName="hoursAlone"
                [options]="hoursAloneOptions"
                placeholder="Select hours alone"
                optionLabel="label"
                optionValue="value"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('hoursAlone')"
              />
              @if (isFieldInvalid('hoursAlone')) {
              <small class="p-error">{{ getFieldError('hoursAlone') }}</small>
              }
            </div>
            <div class="col-12 md:col-6">
              <label for="activityLevel" class="block text-sm font-medium mb-2"
                >Activity Level *</label
              >
              <p-select
                id="activityLevel"
                formControlName="activityLevel"
                [options]="activityLevelOptions"
                placeholder="Select your activity level"
                optionLabel="label"
                optionValue="value"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('activityLevel')"
              />
              @if (isFieldInvalid('activityLevel')) {
              <small class="p-error"
                >{{ getFieldError('activityLevel') }}</small
              >
              }
            </div>
            <div class="col-12">
              <label for="vetReference" class="block text-sm font-medium mb-2"
                >Veterinarian Reference</label
              >
              <input
                pInputText
                id="vetReference"
                formControlName="vetReference"
                placeholder="Name and contact of your veterinarian (if applicable)"
                class="w-full"
                [class.p-invalid]="isFieldInvalid('vetReference')"
              />
              @if (isFieldInvalid('vetReference')) {
              <small class="p-error">{{ getFieldError('vetReference') }}</small>
              }
            </div>
          </div>
        </div>

        <p-divider />

        <!-- Why Adopt Section -->
        <div class="form-section mb-6">
          <h3 class="text-lg font-semibold text-900 mb-4">
            Why do you want to adopt {{ pet()!.name }}?
          </h3>
          <textarea
            pInputText
            formControlName="whyAdopt"
            rows="4"
            placeholder="Please tell us why you would like to adopt this pet (minimum 50 characters)"
            class="w-full"
            [class.p-invalid]="isFieldInvalid('whyAdopt')"
          ></textarea>
          @if (isFieldInvalid('whyAdopt')) {
          <small class="p-error">{{ getFieldError('whyAdopt') }}</small>
          }
        </div>

        <p-divider />

        <!-- Agreement Section -->
        <div class="form-section mb-6">
          <h3 class="text-lg font-semibold text-900 mb-4">Agreement</h3>
          <div class="flex align-items-center mb-3">
            <p-checkbox
              formControlName="agreeToTerms"
              [binary]="true"
              inputId="agreeToTerms"
              class="mr-2"
            />
            <label for="agreeToTerms" class="text-sm">
              I agree to the terms and conditions of adoption *
            </label>
          </div>
          @if (isFieldInvalid('agreeToTerms')) {
          <small class="p-error block"
            >{{ getFieldError('agreeToTerms') }}</small
          >
          }

          <div class="flex align-items-center">
            <p-checkbox
              formControlName="agreeToHomeVisit"
              [binary]="true"
              inputId="agreeToHomeVisit"
              class="mr-2"
            />
            <label for="agreeToHomeVisit" class="text-sm">
              I agree to a home visit if required
            </label>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-3 justify-content-end">
          <p-button
            type="button"
            label="Cancel"
            severity="secondary"
            [outlined]="true"
            (onClick)="onCancel()"
          />
          <p-button
            type="submit"
            label="Submit Application"
            icon="pi pi-send"
            [loading]="isSubmitting()"
            [disabled]="!applicationForm.valid"
          />
        </div>
      </form>
    </p-card>
    } @if (!pet()) {
    <div class="text-center py-8">
      <i class="pi pi-exclamation-triangle text-6xl text-orange-500 mb-4"></i>
      <h3 class="text-2xl font-semibold text-900 mb-3">No Pet Selected</h3>
      <p class="text-600 mb-4">
        Please select a pet from the browse page to start your adoption
        application.
      </p>
      <p-button
        label="Browse Pets"
        icon="pi pi-search"
        (onClick)="router.navigate(['/browse'])"
      />
    </div>
    }
  </div>
</div>

<p-toast />
