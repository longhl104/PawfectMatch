<div class="verification-container">
  <div class="verification-header">
    <button type="button" class="back-btn" (click)="goBack()">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        height="20"
        viewBox="0 0 960 960"
        width="20"
        >
        <path
          d="m313-440 224 224-57 56-320-320 320-320 57 56-224 224h487v80H313Z"
          />
      </svg>
      Back to Choice
    </button>

    <h1>Verify Your Email</h1>
    <p>
      We've sent a 6-digit verification code to <strong>{{ email() }}</strong>
    </p>
  </div>

  <div class="verification-card">
    <div class="code-input-section">
      <h2>Enter Verification Code</h2>
      <p id="code-instruction" class="instruction">
        Enter the 6-digit code from your email
      </p>

      <div class="code-inputs" role="group" aria-labelledby="code-label">
        <label id="code-label" class="sr-only">6-digit verification code</label>
        @for (digit of code(); track $index) {
          <input
            #codeInput
            type="text"
            class="code-digit"
            maxlength="1"
            pattern="[0-9]"
            inputmode="numeric"
            autocomplete="one-time-code"
            (input)="onCodeInput($event, $index)"
            (keydown)="onKeyDown($event, $index)"
            [disabled]="isSubmitting()"
            [attr.aria-label]="'Digit ' + ($index + 1)"
            [attr.aria-describedby]="$index === 0 ? 'code-instruction' : null"
            />
        }
      </div>

      <button
        type="button"
        class="verify-btn"
        (click)="verifyCode()"
        [disabled]="!isCodeCompleted() || isSubmitting()"
        >
        @if (!isSubmitting()) {
          <span>Verify Code</span>
        }
        @if (isSubmitting()) {
          <span class="loading">
            <svg class="spinner" viewBox="0 0 50 50">
              <circle
                cx="25"
                cy="25"
                r="20"
                fill="none"
                stroke="currentColor"
                stroke-width="5"
                stroke-linecap="round"
                stroke-dasharray="31.416"
                stroke-dashoffset="31.416"
                >
                <animate
                  attributeName="stroke-dasharray"
                  dur="2s"
                  values="0 31.416;15.708 15.708;0 31.416"
                  repeatCount="indefinite"
                  />
                <animate
                  attributeName="stroke-dashoffset"
                  dur="2s"
                  values="0;-15.708;-31.416"
                  repeatCount="indefinite"
                  />
              </circle>
            </svg>
            Verifying...
          </span>
        }
      </button>
    </div>

    <div class="resend-section">
      <p>Didn't receive the code?</p>

      <button
        type="button"
        class="resend-btn"
        (click)="resendCode()"
        [disabled]="!canResend() || isResending()"
        >
        @if (!isResending() && canResend()) {
          <span>Resend Code</span>
        }
        @if (!isResending() && !canResend()) {
          <span>
            Resend in {{ resendCountdown() }}s
          </span>
        }
        @if (isResending()) {
          <span class="loading">
            <svg class="spinner" viewBox="0 0 50 50">
              <circle
                cx="25"
                cy="25"
                r="20"
                fill="none"
                stroke="currentColor"
                stroke-width="5"
                stroke-linecap="round"
                stroke-dasharray="31.416"
                stroke-dashoffset="31.416"
                >
                <animate
                  attributeName="stroke-dasharray"
                  dur="2s"
                  values="0 31.416;15.708 15.708;0 31.416"
                  repeatCount="indefinite"
                  />
                <animate
                  attributeName="stroke-dashoffset"
                  dur="2s"
                  values="0;-15.708;-31.416"
                  repeatCount="indefinite"
                  />
              </circle>
            </svg>
            Sending...
          </span>
        }
      </button>
    </div>

    <div class="help-section">
      <h3>Having trouble?</h3>
      <ul>
        <li>Check your spam/junk folder</li>
        <li>Make sure you entered the correct email address</li>
        <li>The code expires after 15 minutes</li>
        <li>Contact support if you continue having issues</li>
      </ul>
    </div>
  </div>
</div>
