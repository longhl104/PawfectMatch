<div class="registration-container">
  <div class="registration-header">
    <p-button
      icon="pi pi-arrow-left"
      label="Back to Choice"
      [text]="true"
      (onClick)="goBack()"
      styleClass="back-btn"
    >
    </p-button>

    <h1>Join as an Adopter</h1>
    <p>Find your perfect companion and give a pet a loving home</p>
  </div>

  <p-card class="registration-card">
    <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()" novalidate>
      <!-- First Name and Last Name -->
      <div class="form-row">
        <div class="form-group">
          <p-iftalabel>
            <input
              pInputText
              id="firstName"
              formControlName="firstName"
              class="w-full"
              [class.ng-invalid]="isFieldInvalid('firstName')"
            />
            <label for="firstName">First Name *</label>
          </p-iftalabel>
          @if (isFieldInvalid("firstName")) {
            <small class="p-error">
              @if (registrationForm.get("firstName")?.errors?.["required"]) {
                First name is required
              }
              @if (registrationForm.get("firstName")?.errors?.["minlength"]) {
                First name must be at least 2 characters
              }
            </small>
          }
        </div>

        <div class="form-group">
          <p-iftalabel>
            <input
              pInputText
              id="lastName"
              formControlName="lastName"
              class="w-full"
              [class.ng-invalid]="isFieldInvalid('lastName')"
            />
            <label for="lastName">Last Name *</label>
          </p-iftalabel>
          @if (isFieldInvalid("lastName")) {
            <small class="p-error">
              @if (registrationForm.get("lastName")?.errors?.["required"]) {
                Last name is required
              }
              @if (registrationForm.get("lastName")?.errors?.["minlength"]) {
                Last name must be at least 2 characters
              }
            </small>
          }
        </div>
      </div>

      <!-- Email -->
      <div class="form-group">
        <p-iftalabel>
          <input
            pInputText
            id="email"
            type="email"
            formControlName="email"
            autocomplete="email"
            class="w-full"
            [class.ng-invalid]="isFieldInvalid('email')"
          />
          <label for="email">Email Address *</label>
        </p-iftalabel>
        @if (isFieldInvalid("email")) {
          <small class="p-error">
            @if (registrationForm.get("email")?.errors?.["required"]) {
              Email is required
            }
            @if (registrationForm.get("email")?.errors?.["email"]) {
              Please enter a valid email address
            }
          </small>
        }
      </div>

      <!-- Password -->
      <div class="form-group">
        <p-iftalabel>
          <p-password
            id="password"
            formControlName="password"
            autocomplete="new-password"
            inputStyleClass="w-full"
            class="w-full"
            [toggleMask]="true"
            [feedback]="true"
            [class.ng-invalid]="isFieldInvalid('password')"
          >
          </p-password>
          <label for="password">Password *</label>
        </p-iftalabel>
        @if (isFieldInvalid("password")) {
          <small class="p-error">
            @if (registrationForm.get("password")?.errors?.["required"]) {
              Password is required
            }
            @if (registrationForm.get("password")?.errors?.["minlength"]) {
              Password must be at least 8 characters
            }
            @if (registrationForm.get("password")?.errors?.["pattern"]) {
              Password must contain uppercase, lowercase, number and special
              character
            }
          </small>
        }
      </div>

      <!-- Confirm Password -->
      <div class="form-group">
        <p-iftalabel>
          <p-password
            id="confirmPassword"
            formControlName="confirmPassword"
            autocomplete="new-password"
            inputStyleClass="w-full"
            class="w-full"
            [toggleMask]="true"
            [feedback]="false"
            [class.ng-invalid]="isFieldInvalid('confirmPassword')"
          >
          </p-password>
          <label for="confirmPassword">Confirm Password *</label>
        </p-iftalabel>
        @if (
          registrationForm.get("confirmPassword")?.errors?.["required"] ||
          (registrationForm.errors?.["passwordMismatch"] &&
            registrationForm.get("confirmPassword")?.touched)
        ) {
          <small class="p-error">
            @if (
              registrationForm.get("confirmPassword")?.errors?.["required"]
            ) {
              Please confirm your password
            }

            @if (
              registrationForm.errors?.["passwordMismatch"] &&
              registrationForm.get("confirmPassword")?.touched
            ) {
              Passwords do not match
            }
          </small>
        }
      </div>

      <!-- Phone Number -->
      <div class="form-group">
        <label class="field-label">Phone Number (optional)</label>
        <div class="phone-input-group">
          <p-select
            formControlName="countryCode"
            [options]="countryCodes"
            optionLabel="label"
            optionValue="value"
            placeholder="Select country"
            class="country-code-select"
          >
            <ng-template #selectedItem let-selectedOption>
              {{ selectedOption?.value || '+1' }}
            </ng-template>
          </p-select>
          <input
            pInputText
            id="phoneNumber"
            type="tel"
            formControlName="phoneNumber"
            placeholder="Enter phone number"
            class="w-full"
            [class.ng-invalid]="isFieldInvalid('phoneNumber')"
          />
        </div>
        @if (isFieldInvalid("phoneNumber")) {
          <small class="p-error">
            @if (registrationForm.get("phoneNumber")?.errors?.["pattern"]) {
              Please enter a valid phone number (6-15 digits)
            }
          </small>
        }
      </div>

      <!-- Address with Google Maps Autocomplete -->
      <app-address-input
        label="Address"
        placeholder="Enter your full address"
        [required]="true"
        id="address"
        formControlName="address"
        (addressSelected)="onAddressSelected($event)"
        [errorMessages]="{
          required: 'Address is required',
          invalidAddress: 'Please select a valid address from the suggestions',
        }"
      ></app-address-input>

      <!-- Bio/Motivation -->
      <div class="form-group">
        <p-iftalabel>
          <textarea
            pTextarea
            id="bio"
            formControlName="bio"
            rows="4"
            maxlength="500"
            class="w-full"
            [autoResize]="true"
          >
          </textarea>
          <label for="bio">Brief Bio / Motivation (optional)</label>
        </p-iftalabel>
        <div class="char-count">
          {{ registrationForm.get("bio")?.value?.length || 0 }}/500 characters
        </div>
      </div>

      <!-- Terms and Conditions -->
      <div class="form-group checkbox-group">
        <div class="checkbox-wrapper">
          <p-checkbox
            formControlName="agreeToTerms"
            [binary]="true"
            inputId="agreeToTerms"
            [class.ng-invalid]="isFieldInvalid('agreeToTerms')"
          >
          </p-checkbox>
          <label for="agreeToTerms">
            I agree to the
            <a href="/terms" target="_blank">Terms and Conditions</a> and
            <a href="/privacy" target="_blank">Privacy Policy</a> *
          </label>
        </div>
        @if (isFieldInvalid("agreeToTerms")) {
          <small class="p-error">
            @if (registrationForm.get("agreeToTerms")?.errors?.["required"]) {
              You must agree to the terms and conditions
            }
          </small>
        }
      </div>

      <!-- Submit Button -->
      <p-button
        type="submit"
        label="Create Account"
        [loading]="isSubmitting"
        loadingIcon="pi pi-spinner pi-spin"
        [disabled]="registrationForm.invalid || isSubmitting"
        styleClass="w-full submit-btn"
      >
      </p-button>

      <!-- Login Link -->
      <div class="login-link">
        <p>
          Already have an account? <a routerLink="/auth/login">Sign in here</a>
        </p>
      </div>
    </form>
  </p-card>
</div>
